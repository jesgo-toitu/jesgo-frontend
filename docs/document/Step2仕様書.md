<style>
BODY {
    font-family: 'BIZ UDPMincho', serif;
}
</style>
# 婦人科悪性腫瘍総合入力システム<br/>JESGO(Japan entry system of gynecologic oncology)<br/>Step2

<table style="margin-top: 5rem; margin-left: auto; margin-right: auto;">
<tr><td>proof</td><td>2022-10-06 山本(P4mohnet)</td></tr>
</table>

## 1.JESGO Step2について
JESGO Step2では、step1で実装されたドキュメントの作成機能に対して、以下の機能を付与する。

- ドキュメントからの情報抽出
  - 抽出された情報に対する検証
  - 抽出された情報の整形
  - 抽出された情報の出力
- 与えられた情報によるドキュメントの操作
  - 外部からの情報入力によるドキュメントの新規作成、ドキュメント内項目の設定
  - ドキュメントから抽出された情報によるドキュメントの新規作成、ドキュメント内項目の設定

## 2.セキュリティに関する事項
スクリプトはシステム側が用意する者の他、ユーザが独自に作成、システムに登録することが可能である。
スクリプトの実行に関しては、ユーザ権限により以下の制限が掛けられることが望ましい。

- スクリプトのシステムへの導入、削除、実行が可能
- 全てのスクリプトの実行が可能
- ドキュメントからの情報抽出のみ実施可能
- ドキュメントからの情報抽出ならびにその抽出情報に基づいたドキュメント内項目の設定が可能
- スクリプトの実行不許可

ドキュメントの新規作成やドキュメント内項目の設定がある場合は、逐次ユーザに対してその内容の確認を行う。ただし、ユーザの許可によりセッション内においては個別の確認を省略することができる。

## 3.スクリプトが対象とするドキュメント
スクリプトが対象とするドキュメントは以下の単位を想定する。

- データベースが保持する全ての患者レコードから年次などで抽出された患者レコードと患者の保有するドキュメント全体
- データベースが保持する全ての患者レコードからスクリプトの要求する条件で抽出された患者レコードと患者の保有するドキュメント全体
- データベースが保持する全ての患者レコードからスクリプトの要求する条件で抽出された個別のドキュメントとそこから連なる一連のドキュメント

上記はデータベース全体を参照するので患者リスト画面から実行する。スクリプトからの抽出要求が無い場合は、ユーザに対して患者リスト画面での抽出作業を要求する。

- 各患者の患者レコードと保有するドキュメント全体

上記は患者編集画面から患者個別に実行する。

- 指定したドキュメントに連なる一連のドキュメント

上記はスクリプトの要求するドキュメント(ドキュメントidで管理)が開かれているときにドキュメントメニューから実行する。

## 4.スクリプトの管理
スクリプトの導入と削除は、その権限を持つユーザによって行われる。

スクリプトは、バックエンドのデータベース内に保存され、その実行はフロントエンドで行われる。
バックエンドのデータベースには、スクリプトの名称、スクリプトのバージョン、スクリプトが要求するドキュメントの種別やid、ならびにスクリプト本体が保存される。
基本的に、同じスクリプトの名称が同じ場合はバージョンの新しいもので上書きされる。ただし、古いバージョンのもので上書きすることも許容される。

## 5.スクリプトの仕様
JavaScriptモジュールに準じたものが望ましい。
ただし、バックエンドから文字列として渡された情報を動作させるため、複数に分割したファイルを導入することは容易ではない。

## 6.スクリプトの実装に関わる問題点
バックエンドから文字列として渡されたスクリプトをフロントエンドで実行するため、モダンブラウザを用いるJESGOではXSSの警告が発せられるので適当な対応が必要である。

また、フロントエンドとして、スクリプト側が要求しうるユーザ確認の操作、別のウインドウやファイルへの出力の機能を提供する必要がある。

スクリプトがメモリを占有することを避ける為、スクリプトの実行が終了した時点でスクリプトのもつインスタンスを終了する必要がある。
